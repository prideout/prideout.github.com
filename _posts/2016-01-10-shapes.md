---
layout: modern
tags : [graphics]
description : "Single-file C library for generating simple triangle meshes from parametric surfaces and polyhedra."
thumbnail : Shapes-masked.png
title : par_shapes.h
---
{% include JB/setup %}

# [par_shapes.h](https://github.com/prideout/par/blob/master/par_shapes.h)

When tinkering with a new graphics engine or renderer, I often want to test it out with simple shapes, and not worry about loading art assets.

<img src="{{ ASSET_PATH }}/figures/platonic800.png" class="figure nice-image">

So, I wrote a single-file C library that can generate simple shapes and perform basic operations on them, such as:

- Applying affine transformations
- Computing surface normals
- Welding colocated vertices

The library provides a set of functions that populate fields of the following structure.

{% highlight c %}
typedef struct par_shapes_mesh_s {
    float* points;
    int npoints;
    uint16_t* triangles;
    int ntriangles;
    float* normals; // optional
    float* tcoords; // optional
} par_shapes_mesh;
{% endhighlight %}

The two optional fields might be null, but every other field is guaranteed to have valid values.  This mesh representation is very limited: indices must be unsigned 16-bit integers, points must be three-tuples, and there is no support for face-varying data.

When you're done extracting the data you need from the mesh, be sure to free it:

{% highlight c %}
par_shapes_mesh* m = par_shapes_create_subdivided_sphere(1);
// ...
par_shapes_free_mesh(m);
{% endhighlight %}

### Platonic Solids

The scene was at the top of the page was constructed like so:

{% highlight c %}
dodecahedron = par_shapes_create_dodecahedron();
par_shapes_translate(dodecahedron, 0, 0.934, 0);

tetrahedron = par_shapes_create_tetrahedron();
par_shapes_translate(tetrahedron, 1, 0, 3.5);

octohedron = par_shapes_create_octohedron();
par_shapes_translate(octohedron, -2.25, 0.9, -.5);

icosahedron = par_shapes_create_icosahedron();
par_shapes_translate(icosahedron, -1, 0.8, 3.5);

cube = par_shapes_create_cube();
par_shapes_rotate(cube, PAR_PI / 5.0, (float yaxis[]){0, 1, 0});
par_shapes_translate(cube, 1, 0, 0.5);
par_shapes_scale(cube, 1.2, 1.2, 1.2);
{% endhighlight %}

Upon creation, platonic solids are welded and do not have normals or texture coordinates.

Since normals can only be per-vertex, you might need to unweld a mesh in order to perform real-time lighting with facet normals.  Here's how to unweld the dodecahedron and populate its `normals` field:

{% highlight c %}
par_shapes_unweld(dodecahedron)
par_shapes_compute_normals(dodecahedron)
{% endhighlight %}

### Parametric Surfaces

The shapes library can also generate various parametric surfaces.  Unlike the platonic solids, these shapes are populated with smooth normals and texture coordinates, right out of the box.

<img src="{{ ASSET_PATH }}/figures/parametric800.png" class="figure nice-image">

The above scene was constructed like so:

{% highlight c %}
// Tessellate an open-ended cylinder with 30 slices and 3 stacks.
shape = par_shapes_create_cylinder(30, 3);
par_shapes_rotate(shape, -PARG_PI / 2.0, (float[]) {1, 0, 0});
par_shapes_translate(shape, 0, 0, 3);

// Create a disk-shaped cylinder cap with 30 slices.
shape = par_shapes_create_disk(1, 30, (float[]){0, 1, 3},
    (float[]){0, 1, 0});

// Instantiate a dome shape.
shape = par_shapes_create_hemisphere(10, 10);
par_shapes_scale(shape, 0.2, 0.2, 0.2);
par_shapes_translate(shape, 0, 1, 3);

// Create a rectangular backdrop.
shape = par_shapes_create_plane(3, 3);
par_shapes_translate(shape, -0.5, 0, 1);
par_shapes_scale(shape, 4, 1.5, 1);

// Place a submerged donut into the scene.
shape = par_shapes_create_torus(30, 40, 0.1);
par_shapes_scale(shape, 2, 2, 2);
par_shapes_translate(shape, 0, 0, 3);
{% endhighlight %}

All parametric generators take two tessellation levels: **slices** and **stacks**, which control the number of divisions across the UV domain.

If the ready-made surfaces are insufficient, clients can use a callback function to create a custom parametric surface:

{% highlight c %}
typedef void (*par_shapes_fn)(float const*, float*, void*);

// Create a parametric surface from a callback function that consumes a 2D
// point in [0,1] and produces a 3D point.
par_shapes_mesh* par_shapes_create_parametric(par_shapes_fn, int slices,
    int stacks, void* userdata);
{% endhighlight %}

## Spheres

The shapes library provides two ways of generating spheres, and both have a fixed size and position: **radius=1** and **center=(0,0,0)**.  Clients can easily scale / translate the result as needed.

{% highlight c %}
// Create a sphere with texture coordinates and small triangles near the poles.
par_shapes_mesh* par_shapes_create_parametric_sphere(int slices, int stacks);

// Generate a sphere from a subdivided icosahedron, which produces a nicer
// distribution of triangles, but no texture coordinates.
par_shapes_mesh* par_shapes_create_subdivided_sphere(int nsubdivisions);
{% endhighlight %}

<img src="{{ ASSET_PATH }}/figures/sphere800.png" class="figure nice-image">

In the above image, the left and center spheres are subdivided, while the right sphere is the parametric variant.

### Miscellaneous

The library also provides generator functions for various shapes beyond what was covered here; see the header file for more information.

<img src="{{ ASSET_PATH }}/figures/misc800.png" class="figure nice-image">

<hr>

Here are links to the library and the github repo that it lives in.

- [par_shapes.h](https://github.com/prideout/par/blob/master/par_shapes.h)
- [prideout/par](https://github.com/prideout/par)
